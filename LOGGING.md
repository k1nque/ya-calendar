# –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üìã –û–±–∑–æ—Ä

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–Ω—è–º.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–í—Å–µ –ª–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/app/logs` (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `./logs` –Ω–∞ —Ö–æ—Å—Ç–µ):

```
logs/
‚îú‚îÄ‚îÄ bot.log              # –¢–µ–∫—É—â–∏–µ –ª–æ–≥–∏ Telegram –±–æ—Ç–∞
‚îú‚îÄ‚îÄ worker.log           # –¢–µ–∫—É—â–∏–µ –ª–æ–≥–∏ Calendar sync worker
‚îú‚îÄ‚îÄ celery_worker.log    # –¢–µ–∫—É—â–∏–µ –ª–æ–≥–∏ Celery task worker
‚îú‚îÄ‚îÄ bot.log.2025-10-01   # –ê—Ä—Ö–∏–≤–Ω—ã–µ –ª–æ–≥–∏ –∑–∞ 1 –æ–∫—Ç—è–±—Ä—è
‚îú‚îÄ‚îÄ worker.log.2025-10-01
‚îî‚îÄ‚îÄ ...
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—Ç–∞—Ü–∏–∏
- **–ß–∞—Å—Ç–æ—Ç–∞**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –ø–æ–ª–Ω–æ—á—å (midnight)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- **–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏**: `<service>.log.YYYY-MM-DD`
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
```
YYYY-MM-DD HH:MM:SS - <logger_name> - <LEVEL> - <message>
```

–ü—Ä–∏–º–µ—Ä:
```
2025-10-01 15:30:45 - worker - INFO - Successfully processed 5 events
2025-10-01 15:31:12 - celery_worker - WARNING - No paid lessons to deduct for student –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
```

## üéØ –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **INFO**: –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
- **WARNING**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **ERROR**: –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **CRITICAL**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

## üìä –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

### Worker (`worker.log`)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ CalDAV
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ Celery
- –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á
- –û—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### Bot (`bot.log`)
- –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ polling
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- HTTP API –∑–∞–ø—Ä–æ—Å—ã

### Celery Worker (`celery_worker.log`)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è worker
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
- –û—Ç–º–µ—Ç–∫–∞ —É—Ä–æ–∫–æ–≤ –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üîç –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–æ–≤
```bash
# –í—Å–µ –ª–æ–≥–∏ –±–æ—Ç–∞
tail -f logs/bot.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ worker
tail -n 100 logs/worker.log

# –õ–æ–≥–∏ celery –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/celery_worker.log
```

### –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
```bash
# –í—Å–µ –æ—à–∏–±–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
grep ERROR logs/*.log

# –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ worker
grep WARNING logs/worker.log

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–∫–∞
grep "lesson_id=123" logs/*.log
```

### –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏–≤–Ω—ã—Ö –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É
cat logs/bot.log.2025-10-01

# –í—Å–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
grep ERROR logs/*.log.2025-10-*
```

## üê≥ Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ `docker-compose.yml`:

```yaml
volumes:
  - ./logs:/app/logs
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ Docker:
```bash
# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f bot
docker-compose logs -f worker
docker-compose logs -f celery

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 bot
```

## üìù Git

–§–∞–π–ª—ã –ª–æ–≥–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –≤ Git (`.gitignore`):
```
logs/*.log
logs/*.log.*
!logs/README.md
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `app/logging_config.py`:

```python
# –î–ª—è DEBUG-—É—Ä–æ–≤–Ω—è –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
logger = setup_root_logging('service_name', log_level=logging.DEBUG)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–í `app/logging_config.py` –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `backupCount`:

```python
file_handler = TimedRotatingFileHandler(
    filename=str(log_file),
    when='midnight',
    interval=1,
    backupCount=60,  # –•—Ä–∞–Ω–∏—Ç—å 60 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 30
    encoding='utf-8',
    utc=False
)
```

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

1. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –æ—à–∏–±–æ–∫:
   ```bash
   grep ERROR logs/*.log | tail -20
   ```

2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞** –ª–æ–≥–æ–≤:
   ```bash
   du -sh logs/
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã** —Å–µ—Ä–≤–∏—Å–æ–≤:
   ```bash
   # –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
   tail -n 1 logs/bot.log
   tail -n 1 logs/worker.log
   tail -n 1 logs/celery_worker.log
   ```

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ WARNING –∏ ERROR
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `grep` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
3. –ê—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`
5. –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ (ELK, Loki, etc.)
